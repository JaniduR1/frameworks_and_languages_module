<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
  <script type="importmap">
    {
      "imports": {
      "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
      }
    }
  </script>

  <div id="app">
    <!--{{ message }}-->
    <h2>Create</h2>
    <form @submit.prevent="postForm">
      <input v-model="item.user_id" name="user_id" placeholder="Enter UID"/> {{ item.user_id }}
      <input v-model="item.keywords" name="keywords" placeholder="Enter Keywords"/> {{ item.keywords }}
      <input v-model="item.description" name="description" placeholder="Enter Description"/> {{ item.description }}
      <input v-model="item.image" name="image" placeholder="Image Url"/> {{ item.image }}
      <input v-model="item.lat" name="lat" placeholder="Enter Latitude"/> {{ item.lat }}
      <input v-model="item.lon" name="lon" placeholder="Enter Longitude"/> {{ item.lon }}
      <button data-action="create_item">Create Item</button>
    </form>

    <h2>Items</h2>
    <ul>
      <li v-for="item of list">
        <span data-field="user_id">{{item.user_id}}</span>
        <span data-field="keywords">{{item.keywords}}</span>
        <span data-field="lat">{{item.description}}</span>
        <img :src="item.image">
        <span data-field="lat">{{item.lat}}</span>
        <span data-field="lat">{{item.lon}}</span>
        <button data-action="delete" @click="deleteItem(item.id)">Delete</button>
      </li>
    </ul>
  </div>

  <script type="module">
  import { createApp } from 'vue'
    
  createApp(
    {
      data() {return {
        message: 'Hello Vue!',
        item: {user_id: '', keywords: '', description: '', image: '', lat: '', lon: ''},
        //seperate keywords
        list: [1,2,3,4,5,6],
      }},

      created() {
          this.clearForm()
          this.getItems()
        },

      methods: {
        clearForm(){
          console.log("Form Cleared!")
          this.item.user_id = ''
          this.item.keywords = ''
          this.item.description = ''
          this.item.image = ''
          this.item.lat = ''
          this.item.lon = ''
        },

      postForm() {
        //console.log(this.item)
        fetch(`/item`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(this.item),
        })
        .then(response => response.json())
        .then(json => console.log('posted stuff', json))
        .then(() => this.clearForm())
        .then(() => this.getItems())
        .catch(err => console.error(err));
      },

      getItems() {
        fetch(`/items`, {
          method: 'GET',
        })

        .then(response => response.json())
        .then(json => {
          console.log("Getting Items!", json)
          this.list = [...json]  // save the json we got back into the variable `items`
        })
        .catch(err => console.error(err))
      },

      deleteItem(id) {
        //console.log(this.item)

        fetch(`item/${id}`, {
            method: 'DELETE',
        })
        //.then(json => console.log('item deleted', json))
        .then(json => console.log('deleteItem()', json))
        .then(() => this.getItems())
        .catch(err => console.error(err));
      },
    }
  }).mount('#app')
  </script>
</body>
</html>